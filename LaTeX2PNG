#!/bin/bash

DEFAULTFILE="Template"
TEXFILE="Template"

while [[ $# -gt 1 ]]; do
    KEY="$1"

    case $KEY in
        -l|--line)
            LINE="$2"
            shift
            ;;
        -b|--border)
            BORDER="$2"
            shift
            ;;
        -g|--background)
            BACKGROUND="$2"
            shift
            ;;
        -d|--displaystyle)
            DISPLAYSTYLE="$2"
            shift
            ;;
        -i|--input)
            INPUTPATH="$2"
            shift
            ;;
        -o|--output)
            OUTPUTPATH="$2"
            shift
            ;;
        --default)
            DEFAULT=YES
            ;;
        *)

            ;;
    esac
    shift
done

if [[ -f $TEXFILE.tex ]]; then
    if pdflatex $TEXFILE.tex -o $DEFAULTFILE.pdf; then
        REMOVE=1
    else
        echo "Error occurs when compiling the TeX file into PDF file."
    fi
else
    echo "The TeX file $TEXFILE.tex does not exist."
fi
echo "PDF file generated."
if [[ $REMOVE = "1" ]]; then
    if rm $TEXFILE.aux $TEXFILE.log; then
        echo ".aux and .log files deleted."
    else
        echo "Cannot remove .aux and .log files."
    fi
fi
if [[ -f $DEFAULTFILE.pdf ]]; then
    echo "Generating PNG image from PDF file."
    if convert -density 800 Template.pdf -quality 800 -background white -alpha remove Output.png; then
        echo "PNG image successfully generated!"
    else
        echo "Failed to generate PNG image."
    fi
else
    echo "The PDF file $DEFAULTFILE.pdf does not exist."
fi

